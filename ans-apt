#!/bin/bash -e

# Shell Script that will auto-call ansible-playbook for me

if [[ $EUID == 0 ]]; then
    echo ""
    echo "Sorry, can't use sudo."
    echo ""
    exit 1
fi

gen_scripts=/Users/$(logname)/git/generalscripts
ansible_hosts="/usr/local/etc/ansible/hosts"
linux_pip="$gen_scripts/linux_dotfiles/requirements-linux.txt"
macos_pip="$gen_scripts/macos_dotfiles/requirements-macos.txt"

function help_text ()
{
cat <<- EOF
My personal shortcutting ansible stuffs!

Options:
    -ua, --update-all       : Updates all Managed Machines
    -uv, --update-virtual   : Updates all Virtual Machines
    -ul, --update-local     : Updates all Local Linux Machines

    -pa, --pip-all	    : Updates Pip on all Machines
    -pl, --pip-linux	    : Updates Pip on all Linux Machines
    -pm, --pip-mac	    : Updates Pip on all macOS Machines

    -ra, --reboot-all       : Reboots all Managed Machines
    -rv, --reboot-virtual   : Reboots all Virtual Machines
    -rl, --reboot-local     : Reboots all Local Linux Machines

    -m,  --monit            : Reloads monit on all Managed Machines

    -sl, --shutdown-local   : Shutdown Local Linux Machines
    -sv, --shutdown-virtual : Shutdown Virtual Machines

There is not currently an option to shutdown all Managed Linux Machines

    -h,  --help             : this help
EOF
}

case "$1" in
    -ua | --update-all )
        echo ""
        echo "Updating all Managed Linux Machines."
        echo ""
        ansible-playbook -i "$ansible_hosts"  "$gen_scripts/ansible/apt_basic.yml"
        ;;
    -uv | --update-virtual )
        echo ""
        echo "Updating only Virtual Machines"
        echo ""
        ansible-playbook -i "$ansible_hosts"  "$gen_scripts/ansible/apt_basic.yml" --limit=virtual
        ;;
    -ul | --update-local )
        echo ""
        echo "Updating only Local Linux Machines"
        echo ""
        ansible-playbook -i "$ansible_hosts"  "$gen_scripts/ansible/apt_basic.yml" --limit=local-linux
        ;;
    -pa | --pip-all )
        echo ""
        echo "Updating Pip on all Managed Machines"
        echo ""
        ansible-playbook "$gen_scripts/ansible/pip-playbook.yml"
        ;;
    -pm | --pip-mac )
        echo ""
        echo "Updating Pip on all macOS Machines"
        echo ""
        ansible-playbook "$gen_scripts/ansible/pip-playbook.yml" --limit=macos
        ;;
    -pl | --pip-linux )
        echo ""
        echo "Updating Pip on all Linux Machines"
        echo ""
        ansible-playbook "$gen_scripts/ansible/pip-playbook.yml" --limit=linux
        ;;
    -ra | --reboot-all )
        echo ""
        echo "Rebooting all Managed Machines"
        echo ""
        ansible-playbook -i "$ansible_hosts" "$gen_scripts/ansible/restart-apt.yml"
        ;;
    -rv | --reboot-virtual )
        echo ""
        echo "Rebooting only Virtual Machines"
        echo ""
        ansible-playbook -i "$ansible_hosts" "$gen_scripts/ansible/restart-apt.yml" --limit=virtual
        ;;
    -rl | --reboot-local )
        echo ""
        echo "Rebooting only Local Machines"
        echo ""
        ansible-playbook -i "$ansible_hosts" "$gen_scripts/ansible/restart-apt.yml" --limit=local-linux
        ;;
    -m | --monit )
        echo ""
        echo "Reloads monit on all linux machines"
        echo ""
        ansible -i "$ansible_hosts" linux -s -m service -a 'name=monit state=reloaded'
        ;;
    -sl | --shutdown-local )
        echo ""
        echo "Shutting down only Local Machines"
        echo ""
        ansible -i "$ansible_hosts" local-linux -s -a 'shutdown -h now'
        ;;
    -sv | --shutdown-virtual )
        echo "Shutting down all Virtual Machines";
        ansible -i "$ansible_hosts" virtual -s -a 'shutdown -h now'
        ;;
    -h | --help )
        help_text &&
        exit 0
        ;;
    * )
        help_text &&
        exit 1
esac
