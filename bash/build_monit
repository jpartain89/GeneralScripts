#!/bin/bash -e

# This builds monit with the --enable-optimized flag set.

function no_sudo ()
    {
        if [[ $EUID == 0 ]]; then
            echo ""
            echo "Sorry, but you can't run as sudo."
            echo ""
            exit 1
        fi
    }

monit_dir=/home/$USER/git/monit

if [[ ! -e "$monit_dir" ]]; then
    echo ""
    echo "Monit's git directory missing."
    echo "Cloning"
    echo ""
    git clone https://tildeslash@bitbucket.org/tildeslash/monit.git "$monit_dir"
fi
if [ ! -e /usr/bin/libtoolize ]; then
    sudo apt-get install libtool -y
fi

cd "$monit_dir" &&
git pull &&
./bootstrap &&
./configure --enable-optimized &&
make &&
sudo make install &&
unset monit_dir
