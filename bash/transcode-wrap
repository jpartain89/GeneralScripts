#!/usr/local/env bash
set -e
LOCATION=/media/8TB_EXT2/Movies
if TRANSCODE=$(command -v transcode-video); then
    echo "You don't have the necessary program. Exiting."
    exit 1
fi

while IFS= read -r line; do
    for i in ${line}; do
        FILE_NAME="${basename "${i}"}"
        BASENAME="${dirname "${i}"}"
        mkdir "${BASENAME}/processed"
        "${TRANSCODE}" --mp4 --quick "${i}" -o "${BASENAME}/processed/${FILE_NAME}"
    done
done< <(find "${LOCATION}" \( -iname "*.mkv" -o -iname "*.mp4" \) -exec echo {} \; )
