---

# The `become` line is required to make sure these do not run with sudo
- hosts: all
  become: no

  vars:
    - default_repo: dotfiles

  tasks:
    - name: Confirm the Initial Repo is Downloaded
      git:
        repo: "https://github.com/jpartain89/{{ default_repo }}.git"
        dest: "{{ git_dir.path }}/{{ default_repo }}"
        update: yes
      failed_when: False

    - name: Run git-autopull from within default_git_repo Location
      shell: 'git -C {{ git_dir.path }}/{{ default_repo }} map {{ item }}'
      args:
        executable: /bin/bash
      with_items:
        - 'pull'
        - 'fetch --all'
        - 'submodule update --init --recursive'
      register: _git_autopull_debug
      failed_when: False

    - debug: var=_git_autopull_debug
