---
# ansible/restart-apt.yml

- hosts: linux
  become: yes

  tasks:
    - name: Restart Machines
      shell: sleep 2 && shutdown -r now "Ansible-Playbook Triggered Restart"
      async: 1
      poll: 0
      become: true
      ignore_errors: true

    - name: Waiting for Machine to Finish Restart
      local_action: wait_for host={{ inventory_hostname }} state=started delay=30 timeout=300
      become: false

    - name: Make sure Monit is Running
      service:
        name: monit
        state: started
