---
# nginx/tasks/main.yml

- name: Configure NGINX Repos on Ubuntu
  apt_repository:
    repo: 'ppa:nginx/development'
    state: present
  register: nginx_ppa_added
  when: ansible_distribution == 'Ubuntu'

- name: Update Apt
  apt:
    update_cache: yes
    cache_valid_time: 7200
    upgrade: full

- name: Install NGINX
  apt:
    name: nginx
    state: latest
  notify: restart nginx

- name: Clone/Update nginx-deployment git repo
  git:
    repo: "{{ jp_git }}/nginx-deployment.git"
    dest: "{{ git_loc }}/nginx-deployment"
    update: yes

- name: Synchronize nginx_conf to /etc/nginx
  synchronize:
    src: "{{ git_loc }}/nginx-deployment/nginx_conf/"
    dest: /etc/nginx
  delegate_to: "{{ inventory_hostname }}"
  notify: "{{ item }}"
  with_items:
    - validate nginx configuration
    - restart nginx

- name: Update Ownership of /etc/nginx
  file:
    path: /etc/nginx
    recurse: yes
    owner: jpartain89
    group: jpartain89
    state: directory
